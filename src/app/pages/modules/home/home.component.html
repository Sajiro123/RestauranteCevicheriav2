<p-toast styleClass="text-2xl" />
<div class="card">
    <div class="mx-auto max-w-md overflow-hidden rounded-xl bg-white md:max-w-2xl" style="max-width: 100%;">
        <!-- IZQUIERDA: MESAS -->
        <div class="md:flex">
            <div class="mesas md:shrink-0">
                <h2>Mesas</h2>
                <div class="grid">
                    <div *ngFor="let mesa of mesas" class="mesa" (click)="seleccionarMesa(mesa)">
                        <div class="estado" [ngClass]="{
                  'ocupada': mesa.estado === '1',
                  'libre': mesa.estado === '0'
                }"></div>
                        <div class="texto">Mesa N¬∫{{ mesa.numero }}</div>
                    </div>
                </div>
            </div>


            <!-- CENTRO: DETALLE DE PEDIDOS -->
            <div class="detalle md:shrink-0  ml-auto" *ngIf="pedido_mesa_status  ">
                <div *ngFor="let numMesa of mesas">

                    <div *ngIf="mesaSeleccionada?.numero == numMesa.numero;" class="mt-5">
                        <div class="fila_botones">
                            <button (click)="editar(numMesa,NuevoPedido)"> <i
                                    class="material-icons">edit</i>Editar</button>
                            <button> <i class="material-icons">description</i>Ticket</button>
                            <button><i class="material-icons">restaurant</i>Cocina</button>
                            <button><i class="material-icons fa-solid fa-money-bill-wave"></i>Cobrar</button>
                            <button><i class="material-icons fa-solid fa-trash"></i>Cancelar</button>
                        </div>
                        <h1 class="text-red-600 text-2xl font-bold text-center">Mesa {{ numMesa.numero }}</h1>
                        <table class="table-auto w-full   h-auto border-collapse border border-gray-400 text-center">
                            <thead>
                                <tr class="">
                                    <th class="border border-gray-300">Cantidad</th>
                                    <th class="border border-gray-300">Categoria</th>
                                    <th class="border border-gray-300">Pedido</th>
                                    <th class="border border-gray-300">Lugar</th>
                                    <th class="border border-gray-300">Precio U.</th>
                                    <th class="border border-gray-300">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border border-gray-300"
                                    *ngFor="let pedido of getPedidosDeMesa(numMesa.numero,pedido_mesa_status)">
                                    <td>{{ pedido.cantidad }}</td>
                                    <td>{{ pedido.categoria }}</td>
                                    <td>{{ pedido.nombre }}</td>
                                    <td>{{ pedido.lugarpedido == 1 ? "Mesa":"Llevar" }}</td>
                                    <td>{{ pedido.precioU }}</td>
                                    <td>{{ pedido.cantidad * pedido.precioU }}</td>
                                </tr>
                                <tr>
                                    <td colspan="6" class="text-right font-bold">Total</td>
                                    <td class="font-bold">
                                        <!-- {{ getPedidosDeMesa(numMesa)
                                    .reduce((acc, p) => acc + p.cantidad * p.precioUnitario, 0)
                                    }} -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr class="my-4 border-gray-300" />
                    </div>
                </div>
            </div>

            <div class="detalle md:shrink-0  ml-auto" *ngIf="!pedido_mesa_status && mesaSeleccionada">
                <div class="md:flex">
                    <div class="text-left mt-4">
                        <p-button (click)="showModal()">
                            <i class="fa-solid fa-calculator" style="font-size: 35px;cursor: pointer;"></i>
                        </p-button>
                    </div>
                    <div class="text-right ml-6">
                        <h2>Pedido de Mesa {{ this.mesaSeleccionada.numero }}</h2>
                    </div>
                </div>
                <div class="container">
                    <div class="summary">

                        <table class="table-auto w-full   h-auto border-collapse border border-gray-400 text-center">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Llevar</th>
                                    <th>Precio</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let pedidosnew of NuevoPedido.pedidodetalle">
                                    <td>{{ pedidosnew.nombre }}</td>
                                    <td>
                                        <button (click)="incrementnewPedido(pedidosnew)">+</button>
                                        {{ pedidosnew.cantidad }}
                                        <button (click)="decrementnewPedido(pedidosnew)">-</button>
                                    </td>
                                    <td>
                                        <p-toggleSwitch [(ngModel)]="pedidosnew.lugarpedido" [trueValue]="'1'"
                                            [falseValue]="'0'">
                                        </p-toggleSwitch>
                                        <!-- <mat-slide-toggle [(ngModel)]="pedidosnew.lugarpedido">{{ pedidosnew.lugarpedido
                                            ==
                                            1 ?
                                            'SI' :
                                            'NO'
                                            }}</mat-slide-toggle> -->
                                    </td>
                                    <td>
                                        <input (keypress)="onlyNumberKey($event)" (keyup)="pricechange(pedidosnew)"
                                            type="text" style="width: 50px;" pInputText id="name"
                                            [(ngModel)]="pedidosnew.preciounitario" required autofocus fluid />
                                    </td>
                                    <td>S/ {{ pedidosnew.total }} </td>
                                    <td>
                                        <!-- <button (click)="remove(pedidosnew)" class="btn btn-danger">üóëÔ∏è</button> -->
                                        <button class="btn btn-warning">‚öôÔ∏è</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="text-right mt-4">
                            <h3>Total: S/{{ total() }}</h3>
                        </div>
                        <div class="text-right mt-4">
                            <p-button [label]="tipomodal =='Registrar' ? 'REGISTRAR PEDIDO' : 'EDITAR PEDIDO'"
                                (click)="FunctionButtonPedido(NuevoPedido)" severity="success"
                                [style]="{'width': '207px','text-align': 'center' }" class="btn btn-success">
                            </p-button>
                        </div>

                        <textarea [(ngModel)]="comentarios" pTextarea placeholder="Mensaje de impresi√≥n en Cocina."
                            rows="3"></textarea>

                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- Modal CALCULTOR-->
    <p-dialog [(visible)]="displayModalCalculator" [modal]="true" [style]="{width: '30vw'}" [closable]="true">
        <!-- Modal content -->
        <div class="rounded-2xl w-full max-w-md mx-auto p-6 relative">
            <!-- Modal body -->
            <div class="text-center">
                <h3 class="text-lg font-medium mb-4">Ingresar Plato N¬∞</h3>
                <input type="number" id="NumberLote" name="NumberLote" placeholder="N√∫mero" [(ngModel)]="numeroPlato"
                    class="w-full text-center text-3xl p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 mb-6" />
            </div>
            <!-- Teclado num√©rico -->
            <div class="grid grid-cols-1 gap-3">
                <ng-container *ngFor="let num of [0,1,2,3,4,5,6,7,8,9]">
                    <div (click)="setNumbersSelectDashboard(num)"
                        class="bg-blue-500 text-white text-2xl py-4 rounded-lg cursor-pointer hover:bg-blue-600 text-center">
                        {{ num }}
                    </div>
                </ng-container>

                <!-- Bot√≥n verde (‚úì o enviar) -->
                <div (click)="ListarPedidoNumeroCalculadora()"
                    class="bg-green-500 text-white text-3xl py-4 rounded-lg cursor-pointer hover:bg-green-600 col-span-1 text-center">
                    ‚úì
                </div>
                <!-- Bot√≥n limpiar -->
                <div (click)="setNumbersSelectDashboard('clear')"
                    class="bg-red-500 text-white text-lg py-4 rounded-lg cursor-pointer hover:bg-red-600 text-center">
                    Limpiar
                </div>
            </div>
        </div>

    </p-dialog>
</div>
<p-confirmDialog [style]="{ width: '450px' }" />
